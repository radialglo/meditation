/* /? /\ |) | /\ |_ (_, |_ () 2013-11-04 */
!function(a){"use strict";function b(a,b,c){this.$board=$("#"+a),"single-player"===b?$("#mode-1").attr("checked",!0):$("#mode-2").attr("checked",!0),this.settings=function(){var a="carbon_fibre";return{set_single_player:function(){b="single-player"},is_single_player:function(){return"single-player"===b},set_two_player:function(){b="two-player"},is_two_player:function(){return"two-player"===b},get_card_background:function(){return a},set_card_background:function(b){$(".front").removeClass(this.get_card_background()).addClass(b),a=b}}}(),this.new_board=!0,this.started=!1,this.setImages(c),this.generateBoard()}function c(a){for(var b,c,d=a.length-1;d>0;d--)b=Math.floor(Math.random()*d),c=a[b],a[b]=a[d],a[d]=c;return a}b.prototype={constructor:b,MIN_COUNT:14,WAIT_TIME:1e3,set_card_one:function(a){this.card_one=a},set_card_two:function(a){this.card_two=a},cardsEqual:function(){return this.card_one===this.card_two},get_flip_count:function(){return this.flip_count},increment_flip_count:function(){this.flip_count++},reset_flip_count:function(){this.flip_count=0},reset_flips:function(){setTimeout(function(a){return function(){$(".flip").removeClass("flip"),a.reset_flip_count()}}(this),this.WAIT_TIME)},increment_pair_count:function(){this.pair_count++},reset_pair_count:function(){this.pair_count=0},gameOver:function(){return this.pair_count===this.MIN_COUNT},setImages:function(a){if(!(a.length>=this.MIN_COUNT))throw new Error("There must be a minimum of "+this.MIN_COUNT+" images provided.");a=c(a).slice(0,this.MIN_COUNT),a=a.concat(a),this.image_list=c(a)},getImages:function(){return this.image_list},get_board:function(){return this.$board},generateBoard:function(){var a=this.get_board(),b=this.getImages();if(this.reset_pair_count(),this.reset_flip_count(),this.new_board){for(var c=$(document.createDocumentFragment()),d=0;d<b.length;d++)c.append($("<div/>").addClass("holder").append($("<div/>").addClass("card").append($("<div/>").addClass("front face"),$("<img/>").attr({src:b[d]}).addClass("back face"))).data("index",d));a.append(c),this.attach_card_handler(),this.settings.set_card_background(this.settings.get_card_background()),this.new_board=!1}else $(".holder").each(function(a){$(this).find("img").attr("src",b[a])});var e=this;$("img").load(function(){if(e.settings.is_single_player())e.initialize_single_player();else{if(!e.settings.is_two_player())throw new Error("Invalid game mode selected");e.initialize_two_player()}$("#loader").hide(),e.started=!0})},attach_card_handler:function(){var a=this,b=this.get_board();b.on("click",".holder",function(){var b=$(this),c=b.data("index"),d=a.getImages(),e=d[c];a.started&&!b.hasClass("flip")&&!b.hasClass("done")&&a.get_flip_count()<2&&(b.toggleClass("flip"),a.increment_flip_count(),1===a.get_flip_count()&&a.set_card_one(e),2===a.get_flip_count()&&(a.set_card_two(e),a.cardsEqual()?($(".flip").addClass("done").removeClass("flip"),a.reset_flip_count(),a.increment_pair_count(),a.settings.is_two_player()&&(a.is_turn_one()?a.increment_score_one():a.increment_score_two()),a.gameOver()&&(a.display_results(),a.started=!1)):(a.reset_flips(),a.settings.is_two_player()&&a.change_turns())))})},initialize_single_player:function(){$("#scoreboard").text("").append("<div id='clock'><span id='min'>00</span><em>:</em><span id='sec'>00</span><em>:</em><span id='centisec'>00</span></div>"),this.start_watch()},start_watch:function(){this.start_time=(new Date).getTime(),this.count()},count:function(){!function(a){if(!a.gameOver()){var b=(new Date).getTime()-a.start_time,c=Math.floor(b/6e4),d=Math.floor(b%6e4/1e3),e=Math.floor(b%1e3/10);$("#sec").text(d.toString().replace(/^(\d)$/,"0$1")),$("#min").text(c.toString().replace(/^(\d)$/,"0$1")),$("#centisec").text(e.toString().replace(/^(\d)$/,"0$1")),setTimeout(function(){a.count()},10)}}(this)},is_turn_one:function(){return this.turn_one},player_one_wins:function(){return this.player_one_score>this.player_two_score},is_tie:function(){return this.player_one_score===this.player_two_score},initialize_two_player:function(){$("#scoreboard").html("").append("<i id='player_one' class='icon-user' ></i><span id='score_one' class='score' >0</span><i id='player_two' class='icon-user'></i><span id='score_two' class='score'>0</span>"),this.turn_one=!0,this.reset_pair_count(),this.reset_scores(),setTimeout(function(){$("#player_one").animate({opacity:1}),$("#player_two").animate({opacity:.3})},this.WAIT_TIME)},change_turns:function(){this.turn_one=!this.turn_one,setTimeout(function(a){a.is_turn_one()?($("#player_one").animate({opacity:1}),$("#player_two").animate({opacity:.3})):($("#player_one").animate({opacity:.3}),$("#player_two").animate({opacity:1}))}(this),this.WAIT_TIME)},increment_score_one:function(){this.player_one_score++,this.update_score_one()},increment_score_two:function(){this.player_two_score++,this.update_score_two()},update_score_one:function(){$("#score_one").text(this.player_one_score)},update_score_two:function(){$("#score_two").text(this.player_two_score)},reset_scores:function(){this.player_one_score=0,this.player_two_score=0,this.update_score_one(),this.update_score_two()},display_results:function(){if(this.settings.is_two_player()){var a='<div class="info"><hr/>';a+=this.is_tie()?'<i class="icon-user orange"></i><i class="icon-user orange_red"></i>Tie Game':this.player_one_wins()?'<i class="icon-user orange">Wins</i>':'<i class="icon-user orange_red">Wins</i>',$("#overlay").html("").append(a+'<hr/><i class="icon-play-circle2" title="Play Again"></i><i class="icon-cancel close" title="Close"></i></div></div>').fadeIn()}else $("#overlay").html("").append('<div class="info"><hr/><i class="icon-trophy"></i><hr/>Puzzle Solved! Time: <span class="time">'+$("#clock").text()+'</span><hr/><i class="icon-play-circle2" title="Play Again"></i><i class="icon-cancel close" title="Close"></i>').fadeIn()},restart:function(a){this.started=!1,$(".done").removeClass("done"),$(".flip").removeClass("flip");var b=this;setTimeout(function(){b.setImages(a),b.generateBoard()},2*b.WAIT_TIME)}},"object"==typeof a&&"object"==typeof a.document&&(a.Meditation=b)}(window);